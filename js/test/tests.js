if (typeof require === 'function') {
	globalThis.CBOR = require('../cbor.js');
}

let hasFloat16 = (typeof Float16Array === 'function');
let hasBigInt = (typeof BigInt64Array == 'function' && typeof BigUint64Array === 'function');
let platformBigEndian = new Uint8Array(new Uint16Array([256]).buffer)[0];

let cborTests = [
	// from RFC-7049 Appendix A
	{cbor: "00", data: 0, roundTrip: true},
	{cbor: "01", data: 1, roundTrip: true},
	{cbor: "0a", data: 10, roundTrip: true},
	{cbor: "17", data: 23, roundTrip: true},
	{cbor: "1818", data: 24, roundTrip: true},
	{cbor: "1819", data: 25, roundTrip: true},
	{cbor: "1864", data: 100, roundTrip: true},
	{cbor: "1903e8", data: 1000, roundTrip: true},
	{cbor: "1a000f4240", data: 1000000, roundTrip: true},
	hasBigInt && {cbor: "1b000000e8d4a51000", data: 1000000000000, roundTrip: true},
	hasBigInt && {cbor: "1bffffffffffffffff", data: 18446744073709551615n, roundTrip: true},
	hasBigInt && {cbor: "c249010000000000000000", data: 18446744073709551616n, roundTrip: true},
	hasBigInt && {cbor: "3bffffffffffffffff", data: -18446744073709551616n, roundTrip: true},
	hasBigInt && {cbor: "c349010000000000000000", data: -18446744073709551617n, roundTrip: true},
	{cbor: "20", data: -1, roundTrip: true},
	{cbor: "29", data: -10, roundTrip: true},
	{cbor: "3863", data: -100, roundTrip: true},
	{cbor: "3903e7", data: -1000, roundTrip: true},
	{cbor: "fb3ff199999999999a", data: 1.1, roundTrip: true},
	hasFloat16 && {cbor: "f93e00", data: 1.5, roundTrip: false},
	{cbor: "fa7f7fffff", data: 3.4028234663852886e+38, roundTrip: false},
	{cbor: "fb7e37e43c8800759c", data: 1e+300, roundTrip: true},
	hasFloat16 && {cbor: "f90001", data: 5.960464477539063e-8, roundTrip: false},
	hasFloat16 && {cbor: "f90400", data: 0.00006103515625, roundTrip: false},
	{cbor: "fbc010666666666666", data: -4.1, roundTrip: true},
	hasFloat16 && {cbor: "f97c00", data: Infinity, roundTrip: false},
	hasFloat16 && {cbor: "f97e00", data: NaN, roundTrip: false},
	hasFloat16 && {cbor: "f9fc00", data: -Infinity, roundTrip: false},
	{cbor: "fa7f800000", data: Infinity, roundTrip: false},
	{cbor: "fa7fc00000", data: NaN, roundTrip: false},
	{cbor: "faff800000", data: -Infinity, roundTrip: false},
	{cbor: "fb7ff0000000000000", data: Infinity, roundTrip: false},
	{cbor: "fb7ff8000000000000", data: NaN, roundTrip: false},
	{cbor: "fbfff0000000000000", data: -Infinity, roundTrip: false},
	{cbor: "f4", data: false, roundTrip: true},
	{cbor: "f5", data: true, roundTrip: true},
	{cbor: "f6", data: null, roundTrip: true},
	{cbor: "f7", data: undefined, roundTrip: true},
	{cbor: "f0", data: CBOR.simple[16], roundTrip: true},
	{cbor: "f818", data: CBOR.simple[24], roundTrip: true},
	{cbor: "f8ff", data: CBOR.simple[255], roundTrip: true},
	{cbor: "c074323031332d30332d32315432303a30343a30305a", data: new Date("2013-03-21T20:04:00Z"), roundTrip: false},
	{cbor: "c11a514b67b0", data: new Date(1363896240*1000), roundTrip: true},
	{cbor: "c1fb41d452d9ec200000", data: new Date(1363896240.5*1000), roundTrip: true},
	{cbor: "d74401020304", data: new Uint8Array([1, 2, 3, 4]).buffer /*semantic tag ignored*/, roundTrip: false},
	{cbor: "d818456449455446", data: new Uint8Array([0x64, 0x49, 0x45, 0x54, 0x46]).buffer /*semantic tag ignored*/, roundTrip: false},
	{cbor: "d82076687474703a2f2f7777772e6578616d706c652e636f6d", data: new URL("http://www.example.com"), roundTrip: false /* URL adds a trailing slash to the path*/ },
	{cbor: "d82077687474703a2f2f7777772e6578616d706c652e636f6d2f", data: new URL("http://www.example.com/"), roundTrip: true},
	{cbor: "60", data: "", roundTrip: true},
	{cbor: "6161", data: "a", roundTrip: true},
	{cbor: "6449455446", data: "IETF", roundTrip: true},
	{cbor: "62225c", data: "\"\\", roundTrip: true},
	{cbor: "62c3bc", data: "\u00fc", roundTrip: true},
	{cbor: "63e6b0b4", data: "\u6c34", roundTrip: true},
	{cbor: "64f0908591", data: "\ud800\udd51", roundTrip: true},
	{cbor: "470255333a83fb3f", data: new Uint8Array([2,85,51,58,131,251,63]).buffer, roundTrip: true},
	{cbor: "40", data: new Uint8Array([]).buffer, roundTrip: true},
	{cbor: "80", data: [], roundTrip: true},
	{cbor: "83010203", data: [1,2,3], roundTrip: true},
	{cbor: "8301820203820405", data: [1,[2,3],[4,5]], roundTrip: true},
	{cbor: "98190102030405060708090a0b0c0d0e0f101112131415161718181819", data: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25], roundTrip: true},
	{cbor: "a0", data: {}, roundTrip: true},
	{cbor: "a201020304", data: {1: 2, 3: 4}, roundTrip: false /*JS converts all keys to strings */},
	{cbor: "a26161016162820203", data: {"a":1,"b":[2,3]}, roundTrip: true},
	{cbor: "826161a161626163", data: ["a",{"b":"c"}], roundTrip: true},
	{cbor: "a56161614161626142616361436164614461656145", data: {"a":"A","b":"B","c":"C","d":"D","e":"E"}, roundTrip: true},
	{cbor: "5f42010243030405ff", data: new Uint8Array([1, 2, 3, 4, 5]).buffer, roundTrip: false},
	{cbor: "7f657374726561646d696e67ff", data: "streaming", roundTrip: false},
	{cbor: "9fff", data: [], roundTrip: false},
	{cbor: "9f018202039f0405ffff", data: [1,[2,3],[4,5]], roundTrip: false},
	{cbor: "9f01820203820405ff", data: [1,[2,3],[4,5]], roundTrip: false},
	{cbor: "83018202039f0405ff", data: [1,[2,3],[4,5]], roundTrip: false},
	{cbor: "83019f0203ff820405", data: [1,[2,3],[4,5]], roundTrip: false},
	{cbor: "9f0102030405060708090a0b0c0d0e0f101112131415161718181819ff", data: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25], roundTrip: false},
	{cbor: "bf61610161629f0203ffff", data: {"a":1,"b":[2,3]}, roundTrip: false},
	{cbor: "826161bf61626163ff", data: ["a",{"b":"c"}], roundTrip: false},
	{cbor: "bf6346756ef563416d7421ff", data: {"Fun":true,"Amt":-2}, roundTrip: false},

	// Selected tags from https://www.iana.org/assignments/cbor-tags/cbor-tags.xhtml
	// Sets
	{cbor: "d9010283016374776f22", data: new Set([1, "two", -3]), roundTrip: true},
	// Typed arrays
	{cbor: "d8404501020410ff", data: new Uint8Array([1, 2, 4, 16, 255]), roundTrip: true},
	{cbor: "d84845fffefcf080", data: new Int8Array([-1, -2, -4, -16, -128]), roundTrip: true},
	{cbor: "D84046030061000000", data: new Uint8Array([3,0,97,0,0,0]), roundTrip: true},
	{cbor: "D8484603F761000000", data: new Int8Array([3,-9,97,0,0,0]), roundTrip: true},
	{cbor: "D8454C030000006100000000000000", data: new Uint16Array([3,0,97,0,0,0]), roundTrip: !platformBigEndian},
	{cbor: "D8414C000300000061000000000000", data: new Uint16Array([3,0,97,0,0,0]), roundTrip: platformBigEndian},
	{cbor: "D84D4C0300F7FF6100F0DA00000000", data: new Int16Array([3,-9,97,-9488,0,0]), roundTrip: !platformBigEndian},
	{cbor: "D8494C0003FFF70061DAF000000000", data: new Int16Array([3,-9,97,-9488,0,0]), roundTrip: platformBigEndian},
	{cbor: "D8465818030000000000000061000000000000005CC85D0500000000", data: new Uint32Array([3,0,97,0,90032220,0]), roundTrip: !platformBigEndian},
	{cbor: "D842581800000003000000000000006100000000055DC85C00000000", data: new Uint32Array([3,0,97,0,90032220,0]), roundTrip: platformBigEndian},
	{cbor: "D84E581803000000F7FFFFFF61000000F0DAFFFF5CC85D0500000000", data: new Int32Array([3,-9,97,-9488,90032220,0]), roundTrip: !platformBigEndian},
	{cbor: "D84A581800000003FFFFFFF700000061FFFFDAF0055DC85C00000000", data: new Int32Array([3,-9,97,-9488,90032220,0]), roundTrip: platformBigEndian},
	hasBigInt && {cbor: "D847583003000000000000000000000000000000610000000000000000000000000000005CC85D05000000000000000000000000", data: new BigUint64Array([3n,0n,97n,0n,90032220n,0n]), roundTrip: !platformBigEndian},
	hasBigInt && {cbor: "D8435830000000000000000300000000000000000000000000000061000000000000000000000000055DC85C0000000000000000", data: new BigUint64Array([3n,0n,97n,0n,90032220n,0n]), roundTrip: platformBigEndian},
	hasBigInt && {cbor: "D84F58300300000000000000F7FFFFFFFFFFFFFF6100000000000000F0DAFFFFFFFFFFFF5CC85D0500000000521B4C2FD133E3FF", data: new BigInt64Array([3n,-9n,97n,-9488n,90032220n,-8105800789910702n]), roundTrip: !platformBigEndian},
	hasBigInt && {cbor: "D84B58300000000000000003FFFFFFFFFFFFFFF70000000000000061FFFFFFFFFFFFDAF000000000055DC85CFFE333D12F4C1B52", data: new BigInt64Array([3n,-9n,97n,-9488n,90032220n,-8105800789910702n]), roundTrip: platformBigEndian},
	hasFloat16 && {cbor: "d8544c4842efc81756a2f0007c00fc", data: new Float16Array([3.140625, -9.8671875, 97.4375, -9488, Infinity, -Infinity]), roundTrip: !platformBigEndian},
	hasFloat16 && {cbor: "d8504c4248c8ef5617f0a27c00fc00", data: new Float16Array([3.140625, -9.8671875, 97.4375, -9488, Infinity, -Infinity]), roundTrip: platformBigEndian},
	{cbor: "D8555818DB0F4940E6E91DC174D1C242204214C60CB9AB4C7761E6D9", data: new Float32Array([3.1415927410125732, -9.869604110717773, 97.40908813476562, -9488.53125, 90032224, -8105801046556672]), roundTrip: !platformBigEndian},
	{cbor: "D851581840490FDBC11DE9E642C2D174C61442204CABB90CD9E66177", data: new Float32Array([3.1415927410125732, -9.869604110717773, 97.40908813476562, -9488.53125, 90032224, -8105801046556672]), roundTrip: platformBigEndian},
	{cbor: "D8565830182D4454FB210940DE45BEC93CBD23C02508298C2E5A584061A855F84388C2C0E4295F7321779541AEE4B3D02ECC3CC3", data: new Float64Array([3.141592653589793, -9.869604401089358, 97.40909103400243, -9488.531016070572, 90032220.84293324, -8105800789910702]), roundTrip: !platformBigEndian},
	{cbor: "D8525830400921FB54442D18C023BD3CC9BE45DE40585A2E8C290825C0C28843F855A86141957721735F29E4C33CCC2ED0B3E4AE", data: new Float64Array([3.141592653589793, -9.869604401089358, 97.40909103400243, -9488.531016070572, 90032220.84293324, -8105800789910702]), roundTrip: platformBigEndian},

	/* TODO
		* 43000 & 43001 - complex numbers
	*/
];

if (typeof module === 'object' && module?.exports) module.exports = cborTests;
